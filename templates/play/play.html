{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Play</title>

    <script type="text/javascript">
        function f()
        {
            if (document.addEventListener) {
                if ('onwheel' in document) {
                    // IE9+, FF17+, Ch31+
                    document.addEventListener("wheel", onWheel);
                } else if ('onmousewheel' in document) {
                    // устаревший вариант события
                    document.addEventListener("mousewheel", onWheel);
                } else {
                    // Firefox < 17
                    document.addEventListener("MozMousePixelScroll", onWheel);
                }
            } else { // IE8-
                //document.attachEvent("onmousewheel", onWheel);
            }

            var ships = [];

            {% for ship in game.ships.all %}
                var id = '{{ ship.id }}';
                var url = '{{ ship.image.url }}';
                var image = document.createElement("IMG");
                image.src = url;
                var x = '{{ ship.x }}', y = '{{ ship.y }}';
                var speed = '{{ ship.speed }}', angle = '{{ ship.angle }}';
                var racing = '{{ ship.racing }}', rotate = '{{ ship.rotate }}', braking = '{{ ship.braking }}';
                var hp = '{{ ship.hp }}', maxhp = '{{ ship.maxhp }}';
                var weapons = [];

                {% for weapon in ship.weapons.all %}
                    var w_id = '{{ weapon.id }}';
                    var w_url = '{{ weapon.image.url }}';
                    var w_image = document.createElement("IMG");
                    w_image.src = w_url;
                    var w_title = '{{ weapon.title }}';

                    var w = new Weapon(parseInt(w_id), w_image, w_title);
                    weapons.push(w);
                {% endfor %}

                var s = new Ship(parseInt(id), image, parseFloat(racing), parseFloat(braking), parseFloat(speed), parseFloat(rotate), parseFloat(angle), parseFloat(x), parseFloat(y), parseFloat(hp), parseInt(maxhp), weapons);
                ships.push(s);
            {% endfor %}

            var image1 = document.createElement("IMG");
            var url1 = '{{ game.map.image.url }}';
            image1.src = url1;

            var map = new Map(image1);

            var index = parseInt('{{ index }}');

            var im1 = document.createElement("IMG");
            im1.src = '{{ current.url }}';

            var images = {
                current: im1,
            };

            var shells = [];

            {% for shell in game.shells.all %}
                id = '{{ shell.id }}';
                url = '{{ shell.image.url }}';
                image = document.createElement("IMG");
                image.src = url;
                x = '{{ shell.x }}';
                y = '{{ shell.y }}';
                speed = '{{ shell.speed }}';
                angle = '{{ shell.angle }}';
                var ship_id = '{{ shell.ship_id }}';
                var lifetime = '{{ shell.lifetime }}';
                var time = '{{ shell.time }}';

                s = new Shell(parseInt(id), parseInt(ship_id), image, parseFloat(speed), parseFloat(x), parseFloat(y), parseFloat(angle), parseInt(lifetime), parseFloat(time));
                shells.push(s);
            {% endfor %}

            init(map, ships, shells, index, parseInt('{{ game.id }}'), images);
        }
    </script>

</head>

<body onload="f()">

    <canvas id="myCanvas" width="1300" height="550" style="border:1px solid #d3d3d3; width:100%;height:50%">

    </canvas>

    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <script src="{% static 'js/play.js' %}"></script>

</body>

<script>

</script>

</html>